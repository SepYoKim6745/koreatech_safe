# ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ë¬¸ì„œ (Database Schema)

ì´ ë¬¸ì„œëŠ” VLM Chatbot í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” **ë°ì´í„°ë² ì´ìŠ¤(SQLite)**ì˜ êµ¬ì¡°ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.  
ê°œë°œìê°€ ì•„ë‹Œ ë¶„ë“¤ë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‰½ê²Œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“Œ ê°œìš”

ìš°ë¦¬ëŠ” **ë‘ ê°œì˜ í…Œì´ë¸”**ì„ ì‚¬ìš©í•˜ì—¬ ì±„íŒ… ë°ì´í„°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
1. **ChatSession**: ì±„íŒ…ë°© (ì¹´í†¡ì˜ ë‹¨í†¡ë°© ê°œë…)
2. **ChatMessage**: ì±„íŒ…ë°© ì•ˆì˜ ë©”ì‹œì§€ë“¤ (ë§í’ì„ )

ì´ ë‘˜ì€ **1:N (ì¼ëŒ€ë‹¤) ê´€ê³„**ì…ë‹ˆë‹¤.
> í•˜ë‚˜ì˜ ì±„íŒ…ë°©(`ChatSession`)ì—ëŠ” ì—¬ëŸ¬ ê°œì˜ ë©”ì‹œì§€(`ChatMessage`)ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 1. ChatSession (ì±„íŒ…ë°©)

ì‚¬ìš©ìê°€ "ìƒˆë¡œìš´ ì±„íŒ…"ì„ ì‹œì‘í•  ë•Œë§ˆë‹¤ í•˜ë‚˜ì”© ìƒì„±ë˜ëŠ” **ì±„íŒ…ë°© ì •ë³´**ì…ë‹ˆë‹¤.

| í•„ë“œëª… (Column) | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
| :--- | :--- | :--- | :--- |
| **id** | `Integer` | **(PK)** ì±„íŒ…ë°©ì˜ ê³ ìœ  ë²ˆí˜¸ | `1`, `2`, `10` |
| **title** | `String` | ì±„íŒ…ë°© ì œëª© (ì²« ë©”ì‹œì§€ ë‚´ìš©ì„ ë”°ì˜´) | `"ì´ ì‚¬ì§„ ìœ„í—˜í•´ ë³´ì—¬?"` |
| **created_at** | `DateTime` | ì±„íŒ…ë°©ì´ ì²˜ìŒ ë§Œë“¤ì–´ì§„ ì‹œê°„ | `2024-01-11 14:00:00` |
| **updated_at** | `DateTime` | ë§ˆì§€ë§‰ìœ¼ë¡œ ëŒ€í™”ê°€ ì˜¤ê°„ ì‹œê°„ | `2024-01-11 14:05:30` |

> **ì°¸ê³ **: ì±„íŒ…ë°© ëª©ë¡ì„ ë³´ì—¬ì¤„ ë•ŒëŠ” `updated_at`ì„ ê¸°ì¤€ìœ¼ë¡œ ìµœì‹ ìˆœ ì •ë ¬í•©ë‹ˆë‹¤.

---

## 2. ChatMessage (ë©”ì‹œì§€)

ì±„íŒ…ë°© ì•ˆì—ì„œ ì˜¤ê³  ê°„ **ëŒ€í™” ë‚´ìš©(ë§í’ì„ )**ë“¤ì…ë‹ˆë‹¤.

| í•„ë“œëª… (Column) | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
| :--- | :--- | :--- | :--- |
| **id** | `Integer` | **(PK)** ë©”ì‹œì§€ì˜ ê³ ìœ  ë²ˆí˜¸ | `101`, `102` |
| **session_id** | `Integer` | **(FK)** ì–´ë–¤ ì±„íŒ…ë°©ì˜ ë©”ì‹œì§€ì¸ì§€ ì—°ê²° | `1` (1ë²ˆ ì±„íŒ…ë°© ì†Œì†) |
| **role** | `String` | ëˆ„ê°€ ë§í–ˆëŠ”ì§€ (`user`: ì‚¬ìš©ì, `assistant`: AI) | `"user"` |
| **content** | `Text` | ë©”ì‹œì§€ ë‚´ìš© (í…ìŠ¤íŠ¸) | `"ì•ˆì „ëª¨ ì°©ìš©í–ˆë‚˜ìš”?"` |
| **image_url** | `Text` | ì²¨ë¶€í•œ ì´ë¯¸ì§€ (Base64 ì½”ë“œë¡œ ì €ì¥ë¨) | `data:image/jpeg;base64...` |
| **created_at** | `DateTime` | ë©”ì‹œì§€ê°€ ì „ì†¡ëœ ì‹œê°„ | `2024-01-11 14:02:00` |

---

## ğŸ”— ê´€ê³„ ë‹¤ì´ì–´ê·¸ë¨ (ERD)

```mermaid
erDiagram
    ChatSession ||--|{ ChatMessage : "has (í¬í•¨í•œë‹¤)"
    
    ChatSession {
        int id PK "ê³ ìœ  ë²ˆí˜¸"
        string title "ì œëª©"
        datetime created_at "ìƒì„±ì¼"
        datetime updated_at "ìˆ˜ì •ì¼"
    }

    ChatMessage {
        int id PK "ê³ ìœ  ë²ˆí˜¸"
        int session_id FK "ì±„íŒ…ë°© ë²ˆí˜¸"
        string role "í™”ì (user/assistant)"
        string content "ë‚´ìš©"
        string image_url "ì´ë¯¸ì§€ ë°ì´í„°"
        datetime created_at "ì „ì†¡ ì‹œê°„"
    }
```

---

## ğŸ’¡ ì£¼ìš” ë™ì‘ ì›ë¦¬

1. **ì±„íŒ…ë°© ìƒì„±**: 
   - ì‚¬ìš©ìê°€ ì²« ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ `ChatSession`ì´ ë¨¼ì € ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.
   - ì œëª©(`title`)ì€ ì‚¬ìš©ìì˜ ì²« ë©”ì‹œì§€ ì•ë¶€ë¶„ì„ ë”°ì„œ ìë™ìœ¼ë¡œ ì§€ì–´ì§‘ë‹ˆë‹¤.

2. **ë©”ì‹œì§€ ì €ì¥**:
   - ì‚¬ìš©ìì˜ ì§ˆë¬¸(`user`)ì´ `ChatMessage` í…Œì´ë¸”ì— ì €ì¥ë©ë‹ˆë‹¤.
   - AIì˜ ë‹µë³€(`assistant`)ë„ `ChatMessage` í…Œì´ë¸”ì— ì €ì¥ë©ë‹ˆë‹¤.
   - ì´ë•Œ ë‘ ë©”ì‹œì§€ ëª¨ë‘ `session_id`ì— ë°©ê¸ˆ ë§Œë“  ì±„íŒ…ë°© ë²ˆí˜¸ê°€ ì í™ë‹ˆë‹¤.

3. **ì‚­ì œ (Cascade Delete)**:
   - ë§Œì•½ 1ë²ˆ ì±„íŒ…ë°©(`ChatSession`)ì„ ì‚­ì œí•˜ë©´?
   - 1ë²ˆ ë°©ì— ì—°ê²°ëœ ëª¨ë“  ë©”ì‹œì§€(`ChatMessage` ì¤‘ `session_id`ê°€ 1ì¸ ê²ƒë“¤)ë„ **ìë™ìœ¼ë¡œ í•¨ê»˜ ì‚­ì œ**ë©ë‹ˆë‹¤. (ì°Œêº¼ê¸°ê°€ ë‚¨ì§€ ì•Šì•„ìš”!)
